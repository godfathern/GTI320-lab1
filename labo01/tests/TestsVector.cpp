/**
 * @file TestsVector.cpp
 *
 * @brief Tests unitaires 
 *
 * Nom:
 * Code permanent :
 * Email :
 *
 */

#include "Vector.h"

#include <gtest/gtest.h>

using namespace gti320;


/**
 * Test pour les vecteurs à taille dynamique
 */
TEST(TestLabo, DynamicVectorSizeTest)
{
    Vector<double> v(5);
    v.setZero();

    EXPECT_EQ(v.rows(), 5);

    v.resize(3);
    EXPECT_EQ(v.rows(), 3);

    v(0) = 1.0;
    v(1) = 2.0;
    v(2) = 3.0;

    EXPECT_DOUBLE_EQ(v.norm(), 3.7416573867739413855837487323165);

    Vector<double, Dynamic> v2(3);
    v2.setZero();
    v2(1) = 2.0;

    EXPECT_DOUBLE_EQ(v2.dot(v), 4.0);
    EXPECT_DOUBLE_EQ(v2(0), 0.0);
    EXPECT_DOUBLE_EQ(v2(1), 2.0);
    EXPECT_DOUBLE_EQ(v2(2), 0.0);
}

TEST(TestLabo, DotAndNorm)
{
    {
        Vector<double, 3> u;
        u(0) = 81.74804972455644;
        u(1) = -74.09304417781078;
        u(2) = -91.38202093790602;
        Vector<double, 3> v;
        v(0) = 81.1462118959985;
        v(1) = 29.763442976156085;
        v(2) = 39.00787276684184;
        EXPECT_NEAR(u.dot(v), 863.662223794679, 1e-4) << "(u=(81.74804972455644, -74.09304417781078, -91.38202093790602), v= (81.1462118959985, 29.763442976156085, 39.00787276684184))";
        EXPECT_NEAR(u.norm(), 143.25919370148452, 1e-4) << "(u=(81.74804972455644, -74.09304417781078, -91.38202093790602))";
        u = v;
        EXPECT_NEAR(u.norm(), 94.82712892764025, 1e-4) << "u=(81.74804972455644, -74.09304417781078, -91.38202093790602)";
    }
    {
        Vector<double, 3> u;
        u(0) = 13.087936541928485;
        u(1) = -26.541934227528046;
        u(2) = -48.13859302157102;
        Vector<double, 3> v;
        v(0) = -66.28108277028942;
        v(1) = 11.919000480625243;
        v(2) = -96.21367167640467;
        EXPECT_NEAR(u.dot(v), 3447.7548518990116, 1e-4) << "(u=(13.087936541928485, -26.541934227528046, -48.13859302157102), v= (-66.28108277028942, 11.919000480625243, -96.21367167640467))";
        EXPECT_NEAR(u.norm(), 56.50745520336602, 1e-4) << "(u=(13.087936541928485, -26.541934227528046, -48.13859302157102))";
        u = v;
        EXPECT_NEAR(u.norm(), 117.44068768154457, 1e-4) << "u=(13.087936541928485, -26.541934227528046, -48.13859302157102)";
    }
    {
        Vector<double, 3> u;
        u(0) = -79.56972852806103;
        u(1) = -64.04761691711548;
        u(2) = 75.76398532227091;
        Vector<double, 3> v;
        v(0) = 68.1521534060019;
        v(1) = -38.02548546805114;
        v(2) = 44.66242384133133;
        EXPECT_NEAR(u.dot(v), 396.3966055984092, 1e-4) << "(u=(-79.56972852806103, -64.04761691711548, 75.76398532227091), v= (68.1521534060019, -38.02548546805114, 44.66242384133133))";
        EXPECT_NEAR(u.norm(), 127.17554954748255, 1e-4) << "(u=(-79.56972852806103, -64.04761691711548, 75.76398532227091))";
        u = v;
        EXPECT_NEAR(u.norm(), 89.91877258025103, 1e-4) << "u=(-79.56972852806103, -64.04761691711548, 75.76398532227091)";
    }
    {
        Vector<double, 3> u;
        u(0) = -27.829925590795995;
        u(1) = 97.52374799957443;
        u(2) = -71.29949583706774;
        Vector<double, 3> v;
        v(0) = 15.413123773966177;
        v(1) = -25.9678191712148;
        v(2) = -70.46329734352945;
        EXPECT_NEAR(u.dot(v), 2062.5724349077673, 1e-4) << "(u=(-27.829925590795995, 97.52374799957443, -71.29949583706774), v= (15.413123773966177, -25.9678191712148, -70.46329734352945))";
        EXPECT_NEAR(u.norm(), 123.97178827819569, 1e-4) << "(u=(-27.829925590795995, 97.52374799957443, -71.29949583706774))";
        u = v;
        EXPECT_NEAR(u.norm(), 76.66138721353245, 1e-4) << "u=(-27.829925590795995, 97.52374799957443, -71.29949583706774)";
    }
    {
        Vector<double, 3> u;
        u(0) = 46.94969707999718;
        u(1) = 92.7292896206543;
        u(2) = 61.3890905084975;
        Vector<double, 3> v;
        v(0) = 91.40236621394195;
        v(1) = -23.911909695536067;
        v(2) = -66.18706904017846;
        EXPECT_NEAR(u.dot(v), -1989.1849652004407, 1e-4) << "(u=(46.94969707999718, 92.7292896206543, 61.3890905084975), v= (91.40236621394195, -23.911909695536067, -66.18706904017846))";
        EXPECT_NEAR(u.norm(), 120.71294728783312, 1e-4) << "(u=(46.94969707999718, 92.7292896206543, 61.3890905084975))";
        u = v;
        EXPECT_NEAR(u.norm(), 115.3555377211011, 1e-4) << "u=(46.94969707999718, 92.7292896206543, 61.3890905084975)";
    }
    {
        Vector<double, 3> u;
        u(0) = 9.836648455487577;
        u(1) = 27.373779624683323;
        u(2) = 33.47163213808042;
        Vector<double, 3> v;
        v(0) = -17.904556153169437;
        v(1) = -10.39159035574184;
        v(2) = 36.045191146582226;
        EXPECT_NEAR(u.dot(v), 745.913449426867, 1e-4) << "(u=(9.836648455487577, 27.373779624683323, 33.47163213808042), v= (-17.904556153169437, -10.39159035574184, 36.045191146582226))";
        EXPECT_NEAR(u.norm(), 44.344488065198725, 1e-4) << "(u=(9.836648455487577, 27.373779624683323, 33.47163213808042))";
        u = v;
        EXPECT_NEAR(u.norm(), 41.566983123113395, 1e-4) << "u=(9.836648455487577, 27.373779624683323, 33.47163213808042)";
    }
    {
        Vector<double, 3> u;
        u(0) = 77.34524968701723;
        u(1) = -86.53838659054598;
        u(2) = 52.511893628372974;
        Vector<double, 3> v;
        v(0) = 39.390038592378005;
        v(1) = -53.13512176642368;
        v(2) = 60.23922457130902;
        EXPECT_NEAR(u.dot(v), 10808.13583201148, 1e-4) << "(u=(77.34524968701723, -86.53838659054598, 52.511893628372974), v= (39.390038592378005, -53.13512176642368, 60.23922457130902))";
        EXPECT_NEAR(u.norm(), 127.39183245121873, 1e-4) << "(u=(77.34524968701723, -86.53838659054598, 52.511893628372974))";
        u = v;
        EXPECT_NEAR(u.norm(), 89.4632912562147, 1e-4) << "u=(77.34524968701723, -86.53838659054598, 52.511893628372974)";
    }
    {
        Vector<double, 3> u;
        u(0) = 72.58764125601218;
        u(1) = 13.004884623782146;
        u(2) = 6.688195585248067;
        Vector<double, 3> v;
        v(0) = -41.68110389567836;
        v(1) = 65.83906651972734;
        v(2) = 64.45916748876758;
        EXPECT_NEAR(u.dot(v), -1738.1880334803595, 1e-4) << "(u=(72.58764125601218, 13.004884623782146, 6.688195585248067), v= (-41.68110389567836, 65.83906651972734, 64.45916748876758))";
        EXPECT_NEAR(u.norm(), 74.04609812391155, 1e-4) << "(u=(72.58764125601218, 13.004884623782146, 6.688195585248067))";
        u = v;
        EXPECT_NEAR(u.norm(), 101.12903329655835, 1e-4) << "u=(72.58764125601218, 13.004884623782146, 6.688195585248067)";
    }
    {
        Vector<double, 3> u;
        u(0) = 44.123038783178856;
        u(1) = 59.032307289173275;
        u(2) = -96.45920641599031;
        Vector<double, 3> v;
        v(0) = -23.433056105942327;
        v(1) = -95.82287577132844;
        v(2) = -87.71884659805113;
        EXPECT_NEAR(u.dot(v), 1770.7072393377675, 1e-4) << "(u=(44.123038783178856, 59.032307289173275, -96.45920641599031), v= (-23.433056105942327, -95.82287577132844, -87.71884659805113))";
        EXPECT_NEAR(u.norm(), 121.39206875965131, 1e-4) << "(u=(44.123038783178856, 59.032307289173275, -96.45920641599031))";
        u = v;
        EXPECT_NEAR(u.norm(), 132.006544110677, 1e-4) << "u=(44.123038783178856, 59.032307289173275, -96.45920641599031)";
    }
    {
        Vector<double, 3> u;
        u(0) = -7.594864170286073;
        u(1) = -92.12702535387345;
        u(2) = 10.61833019724412;
        Vector<double, 3> v;
        v(0) = -57.88532008253067;
        v(1) = -61.95047768934079;
        v(2) = -50.9801175870505;
        EXPECT_NEAR(u.dot(v), 5605.620650217189, 1e-4) << "(u=(-7.594864170286073, -92.12702535387345, 10.61833019724412), v= (-57.88532008253067, -61.95047768934079, -50.9801175870505))";
        EXPECT_NEAR(u.norm(), 93.04740565161417, 1e-4) << "(u=(-7.594864170286073, -92.12702535387345, 10.61833019724412))";
        u = v;
        EXPECT_NEAR(u.norm(), 98.9320188623685, 1e-4) << "u=(-7.594864170286073, -92.12702535387345, 10.61833019724412)";
    }
    {
        Vector<double, 3> u;
        u(0) = 28.01623276831728;
        u(1) = -35.47111447521442;
        u(2) = -80.09707278049716;
        Vector<double, 3> v;
        v(0) = 62.23810927998369;
        v(1) = -69.45561657190204;
        v(2) = -17.998932897185853;
        EXPECT_NEAR(u.dot(v), 5649.007321253708, 1e-4) << "(u=(28.01623276831728, -35.47111447521442, -80.09707278049716), v= (62.23810927998369, -69.45561657190204, -17.998932897185853))";
        EXPECT_NEAR(u.norm(), 91.97092110361056, 1e-4) << "(u=(28.01623276831728, -35.47111447521442, -80.09707278049716))";
        u = v;
        EXPECT_NEAR(u.norm(), 94.98224310663369, 1e-4) << "u=(28.01623276831728, -35.47111447521442, -80.09707278049716)";
    }
    {
        Vector<double, 3> u;
        u(0) = 17.056114318144637;
        u(1) = -47.87236586884536;
        u(2) = -66.233990996889;
        Vector<double, 3> v;
        v(0) = -16.5274983107699;
        v(1) = -61.98159750757431;
        v(2) = -95.73085862430288;
        EXPECT_NEAR(u.dot(v), 9025.947640683207, 1e-4) << "(u=(17.056114318144637, -47.87236586884536, -66.233990996889), v= (-16.5274983107699, -61.98159750757431, -95.73085862430288))";
        EXPECT_NEAR(u.norm(), 83.48422613218729, 1e-4) << "(u=(17.056114318144637, -47.87236586884536, -66.233990996889))";
        u = v;
        EXPECT_NEAR(u.norm(), 115.23573197124973, 1e-4) << "u=(17.056114318144637, -47.87236586884536, -66.233990996889)";
    }
    {
        Vector<double, 3> u;
        u(0) = 53.68514451573557;
        u(1) = 40.487633535881685;
        u(2) = -34.39102876903675;
        Vector<double, 3> v;
        v(0) = 5.723467714467617;
        v(1) = -11.984939376053532;
        v(2) = 71.57117734380691;
        EXPECT_NEAR(u.dot(v), -2639.3830610897676, 1e-4) << "(u=(53.68514451573557, 40.487633535881685, -34.39102876903675), v= (5.723467714467617, -11.984939376053532, 71.57117734380691))";
        EXPECT_NEAR(u.norm(), 75.52540016977055, 1e-4) << "(u=(53.68514451573557, 40.487633535881685, -34.39102876903675))";
        u = v;
        EXPECT_NEAR(u.norm(), 72.79306478576713, 1e-4) << "u=(53.68514451573557, 40.487633535881685, -34.39102876903675)";
    }
    {
        Vector<double, 3> u;
        u(0) = -19.41880304735801;
        u(1) = 80.15388147841654;
        u(2) = 18.762371448279836;
        Vector<double, 3> v;
        v(0) = 56.544323419883455;
        v(1) = 37.75922627098413;
        v(2) = -45.767718603712495;
        EXPECT_NEAR(u.dot(v), 1069.8145305211428, 1e-4) << "(u=(-19.41880304735801, 80.15388147841654, 18.762371448279836), v= (56.544323419883455, 37.75922627098413, -45.767718603712495))";
        EXPECT_NEAR(u.norm(), 84.57991020455952, 1e-4) << "(u=(-19.41880304735801, 80.15388147841654, 18.762371448279836))";
        u = v;
        EXPECT_NEAR(u.norm(), 81.96159921441485, 1e-4) << "u=(-19.41880304735801, 80.15388147841654, 18.762371448279836)";
    }
    {
        Vector<double, 3> u;
        u(0) = 14.53101118226931;
        u(1) = -87.12123268098249;
        u(2) = -12.733552633138217;
        Vector<double, 3> v;
        v(0) = -96.36370344463752;
        v(1) = -81.8797705320039;
        v(2) = -25.593956628649764;
        EXPECT_NEAR(u.dot(v), 6059.106481886422, 1e-4) << "(u=(14.53101118226931, -87.12123268098249, -12.733552633138217), v= (-96.36370344463752, -81.8797705320039, -25.593956628649764))";
        EXPECT_NEAR(u.norm(), 89.23790020217884, 1e-4) << "(u=(14.53101118226931, -87.12123268098249, -12.733552633138217))";
        u = v;
        EXPECT_NEAR(u.norm(), 129.01670736710366, 1e-4) << "u=(14.53101118226931, -87.12123268098249, -12.733552633138217)";
    }
    {
        Vector<double, 3> u;
        u(0) = -68.15128360202914;
        u(1) = -35.22142681790423;
        u(2) = -80.20820520692742;
        Vector<double, 3> v;
        v(0) = -71.59083714955358;
        v(1) = -22.11220916087268;
        v(2) = -41.412146034892785;
        EXPECT_NEAR(u.dot(v), 8979.424909853704, 1e-4) << "(u=(-68.15128360202914, -35.22142681790423, -80.20820520692742), v= (-71.59083714955358, -22.11220916087268, -41.412146034892785))";
        EXPECT_NEAR(u.norm(), 110.98874963801407, 1e-4) << "(u=(-68.15128360202914, -35.22142681790423, -80.20820520692742))";
        u = v;
        EXPECT_NEAR(u.norm(), 85.61053438078382, 1e-4) << "u=(-68.15128360202914, -35.22142681790423, -80.20820520692742)";
    }
    {
        Vector<double, 3> u;
        u(0) = 32.15880264107108;
        u(1) = -27.044272757999167;
        u(2) = -21.93384224298498;
        Vector<double, 3> v;
        v(0) = 94.98651607465004;
        v(1) = 96.25601423462368;
        v(2) = -4.364871517549744;
        EXPECT_NEAR(u.dot(v), 547.2171237254174, 1e-4) << "(u=(32.15880264107108, -27.044272757999167, -21.93384224298498), v= (94.98651607465004, 96.25601423462368, -4.364871517549744))";
        EXPECT_NEAR(u.norm(), 47.399100327501664, 1e-4) << "(u=(32.15880264107108, -27.044272757999167, -21.93384224298498))";
        u = v;
        EXPECT_NEAR(u.norm(), 135.3022934606082, 1e-4) << "u=(32.15880264107108, -27.044272757999167, -21.93384224298498)";
    }
    {
        Vector<double, 3> u;
        u(0) = -38.55884639660741;
        u(1) = -32.44768663392304;
        u(2) = -86.51014461651837;
        Vector<double, 3> v;
        v(0) = -32.975270310868936;
        v(1) = -48.59524328395069;
        v(2) = -92.16520328196806;
        EXPECT_NEAR(u.dot(v), 10821.51667331416, 1e-4) << "(u=(-38.55884639660741, -32.44768663392304, -86.51014461651837), v= (-32.975270310868936, -48.59524328395069, -92.16520328196806))";
        EXPECT_NEAR(u.norm(), 100.1181408382185, 1e-4) << "(u=(-38.55884639660741, -32.44768663392304, -86.51014461651837))";
        u = v;
        EXPECT_NEAR(u.norm(), 109.2853641523316, 1e-4) << "u=(-38.55884639660741, -32.44768663392304, -86.51014461651837)";
    }
    {
        Vector<double, 3> u;
        u(0) = -93.94403064987613;
        u(1) = -22.806019440495206;
        u(2) = -6.186803379242534;
        Vector<double, 3> v;
        v(0) = 99.58719003758503;
        v(1) = 11.426147026760503;
        v(2) = 89.17338366240898;
        EXPECT_NEAR(u.dot(v), -10167.905155829267, 1e-4) << "(u=(-93.94403064987613, -22.806019440495206, -6.186803379242534), v= (99.58719003758503, 11.426147026760503, 89.17338366240898))";
        EXPECT_NEAR(u.norm(), 96.87038739221866, 1e-4) << "(u=(-93.94403064987613, -22.806019440495206, -6.186803379242534))";
        u = v;
        EXPECT_NEAR(u.norm(), 134.1642933468604, 1e-4) << "u=(-93.94403064987613, -22.806019440495206, -6.186803379242534)";
    }
    {
        Vector<double, 3> u;
        u(0) = 49.70172009239852;
        u(1) = 35.23095832735339;
        u(2) = -95.645812626239;
        Vector<double, 3> v;
        v(0) = -26.17330847186834;
        v(1) = -13.328976428902024;
        v(2) = 43.288466758804674;
        EXPECT_NEAR(u.dot(v), -5910.811645163534, 1e-4) << "(u=(49.70172009239852, 35.23095832735339, -95.645812626239), v= (-26.17330847186834, -13.328976428902024, 43.288466758804674))";
        EXPECT_NEAR(u.norm(), 113.40018905513546, 1e-4) << "(u=(49.70172009239852, 35.23095832735339, -95.645812626239))";
        u = v;
        EXPECT_NEAR(u.norm(), 52.31247502588592, 1e-4) << "u=(49.70172009239852, 35.23095832735339, -95.645812626239)";
    }
	
    // Test: redimensionner vecteur dynamique
    {
        Vector<float> a(300);
        a.setZero();
        a(0) = 2.0f;
        a(100) = -12.1f;
        Vector<float> b(1);

        b = a;
        EXPECT_EQ(a.rows(), b.rows());

        EXPECT_NEAR(b(0), 2.0f, 1e-9);
        EXPECT_NEAR(b(100), -12.1f, 1e-9);
    }
}

