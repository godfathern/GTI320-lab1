/**
 * @file TestsMatrix.cpp
 *
 * @brief Tests unitaires 
 *
 * Nom:
 * Code permanent :
 * Email :
 *
 */

#include "Matrix.h"

#include <gtest/gtest.h>

using namespace gti320;

// Test les matrices à taille fixe
TEST(TestsMatrix, StaticMatrixTests)
{
    // Créer une matrice à taille fixe
    Matrix<double, 3, 5> M;
    EXPECT_EQ(M.cols(), 5);
    EXPECT_EQ(M.rows(), 3);

    // Redimensionne la matrice (la taille ne doit pas changer).
    M.resize(100, 1000);
    EXPECT_EQ(M.cols(), 5);
    EXPECT_EQ(M.rows(), 3);

    // Test - stockage par colonnes
    Matrix<double, 100, 99, ColumnStorage> ColM;
    ColM.setZero();
    ColM(0, 0) = 1.0;
    ColM(90, 17) = 99.0;
    ColM(10, 33) = 7.2;
    EXPECT_EQ(ColM(0, 0), 1.0);
    EXPECT_EQ(ColM(90, 17), 99.0);
    EXPECT_EQ(ColM(10, 33), 7.2);

    // Test - stockage par lignes
    Matrix<double, 5, 4, RowStorage> RowM;
    RowM.setZero();
    RowM(0, 0) = 2.1;
    RowM(3, 3) = -0.2;
    RowM(4, 3) = 1.2;
    EXPECT_EQ(RowM.rows(), 5);
    EXPECT_EQ(RowM.cols(), 4);
    EXPECT_DOUBLE_EQ(RowM(0, 0), 2.1);
    EXPECT_DOUBLE_EQ(RowM(3, 3), -0.2);
    EXPECT_DOUBLE_EQ(RowM(4, 3), 1.2);
    EXPECT_DOUBLE_EQ(RowM(3, 2), 0.0);

    // Transposée
    const auto RowMT = RowM.transpose();
    EXPECT_EQ(RowMT.rows(), 4);
    EXPECT_EQ(RowMT.cols(), 5);
    EXPECT_DOUBLE_EQ(RowMT(0, 0), 2.1);
    EXPECT_DOUBLE_EQ(RowMT(3, 3), -0.2);
    EXPECT_DOUBLE_EQ(RowMT(3, 4), 1.2);
    EXPECT_DOUBLE_EQ(RowMT(2, 3), 0.0);
}


// Test les matrices avec redimensionnement dynamique
TEST(TestsMatrix, DynamicMatrixTests)
{
    // Créer une matrice à taille dynamique
    // (note : les valeurs par défaut du patron de la classe `Matrix` mettent le
    // le nombre de ligne et de colonnes à `Dynamic`)
    Matrix<double> M(3, 5);
    EXPECT_EQ(M.cols(), 5);
    EXPECT_EQ(M.rows(), 3);

    // Redimensionne la matrice
    M.resize(100, 1000);
    EXPECT_EQ(M.cols(), 1000);
    EXPECT_EQ(M.rows(), 100);

    // Test - stockage par colonnes
    Matrix<double, Dynamic, Dynamic, ColumnStorage> ColM(100, 100);
    ColM.setZero();
    ColM(0, 0) = 1.0;
    ColM(99, 99) = 99.0;
    ColM(10, 33) = 5.0;
    EXPECT_EQ(ColM(0, 0), 1.0);
    EXPECT_EQ(ColM(10, 33), 5.0);
    EXPECT_EQ(ColM(99, 99), 99.0);

    // Test - stockage par lignes
    Matrix<double, Dynamic, Dynamic, RowStorage> RowM(5, 4);
    RowM.setZero();
    RowM(0, 0) = 2.1;
    RowM(3, 3) = -0.2;
    RowM(4, 3) = 1.2;
    EXPECT_EQ(RowM.rows(), 5);
    EXPECT_EQ(RowM.cols(), 4);
    EXPECT_DOUBLE_EQ(RowM(0, 0), 2.1);
    EXPECT_DOUBLE_EQ(RowM(3, 3), -0.2);
    EXPECT_DOUBLE_EQ(RowM(4, 3), 1.2);
    EXPECT_DOUBLE_EQ(RowM(3, 2), 0.0);

    // Transposée
    const auto RowMT = RowM.transpose();
    EXPECT_EQ(RowMT.rows(), 4);
    EXPECT_EQ(RowMT.cols(), 5);
    EXPECT_DOUBLE_EQ(RowMT(0, 0), 2.1);
    EXPECT_DOUBLE_EQ(RowMT(3, 3), -0.2);
    EXPECT_DOUBLE_EQ(RowMT(3, 4), 1.2);
    EXPECT_DOUBLE_EQ(RowMT(2, 3), 0.0);
}

TEST(TestsMatrix, MatrixTranspose)
{
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 2);
        m(0, 0) = 96.65562704596559;
        m(0, 1) = -5.374125981819006;
        m(1, 0) = 64.81364389648456;
        m(1, 1) = -69.97868420900502;
        m(2, 0) = -48.298014749653696;
        m(2, 1) = 81.5535983882881;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), 96.65562704596559);
        EXPECT_DOUBLE_EQ(mtr(0, 1), 64.81364389648456);
        EXPECT_DOUBLE_EQ(mtr(0, 2), -48.298014749653696);
        EXPECT_DOUBLE_EQ(mtr(1, 0), -5.374125981819006);
        EXPECT_DOUBLE_EQ(mtr(1, 1), -69.97868420900502);
        EXPECT_DOUBLE_EQ(mtr(1, 2), 81.5535983882881);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), 96.65562704596559);
        EXPECT_DOUBLE_EQ(mtc(0, 1), 64.81364389648456);
        EXPECT_DOUBLE_EQ(mtc(0, 2), -48.298014749653696);
        EXPECT_DOUBLE_EQ(mtc(1, 0), -5.374125981819006);
        EXPECT_DOUBLE_EQ(mtc(1, 1), -69.97868420900502);
        EXPECT_DOUBLE_EQ(mtc(1, 2), 81.5535983882881);
    }
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 11);
        m(0, 0) = -93.11774348806081;
        m(0, 1) = -98.38480859022877;
        m(0, 2) = -70.06261616604155;
        m(0, 3) = 84.87535684986423;
        m(0, 4) = -99.9818642210925;
        m(0, 5) = -25.11185567441916;
        m(0, 6) = 8.85590979917103;
        m(0, 7) = 32.717509759851936;
        m(0, 8) = 12.677927494307738;
        m(0, 9) = -76.92757015087707;
        m(0, 10) = -80.99502606313347;
        m(1, 0) = -14.108330840223957;
        m(1, 1) = -94.81883611699344;
        m(1, 2) = -45.060719301725285;
        m(1, 3) = -41.383939879963094;
        m(1, 4) = 80.36741308691853;
        m(1, 5) = -87.50961508738959;
        m(1, 6) = -32.65290161505921;
        m(1, 7) = 18.529868291798238;
        m(1, 8) = -46.169755352790595;
        m(1, 9) = 83.67078184672366;
        m(1, 10) = -30.02053885691531;
        m(2, 0) = 5.8022044043901815;
        m(2, 1) = -39.507965223996266;
        m(2, 2) = 38.099939917456425;
        m(2, 3) = -11.891042873050296;
        m(2, 4) = 53.89070563872062;
        m(2, 5) = 23.280098882479578;
        m(2, 6) = -5.0318917624474295;
        m(2, 7) = 31.50255873280196;
        m(2, 8) = 22.629046207699318;
        m(2, 9) = 3.5102931218199416;
        m(2, 10) = -95.03021938861154;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), -93.11774348806081);
        EXPECT_DOUBLE_EQ(mtr(0, 1), -14.108330840223957);
        EXPECT_DOUBLE_EQ(mtr(0, 2), 5.8022044043901815);
        EXPECT_DOUBLE_EQ(mtr(1, 0), -98.38480859022877);
        EXPECT_DOUBLE_EQ(mtr(1, 1), -94.81883611699344);
        EXPECT_DOUBLE_EQ(mtr(1, 2), -39.507965223996266);
        EXPECT_DOUBLE_EQ(mtr(2, 0), -70.06261616604155);
        EXPECT_DOUBLE_EQ(mtr(2, 1), -45.060719301725285);
        EXPECT_DOUBLE_EQ(mtr(2, 2), 38.099939917456425);
        EXPECT_DOUBLE_EQ(mtr(3, 0), 84.87535684986423);
        EXPECT_DOUBLE_EQ(mtr(3, 1), -41.383939879963094);
        EXPECT_DOUBLE_EQ(mtr(3, 2), -11.891042873050296);
        EXPECT_DOUBLE_EQ(mtr(4, 0), -99.9818642210925);
        EXPECT_DOUBLE_EQ(mtr(4, 1), 80.36741308691853);
        EXPECT_DOUBLE_EQ(mtr(4, 2), 53.89070563872062);
        EXPECT_DOUBLE_EQ(mtr(5, 0), -25.11185567441916);
        EXPECT_DOUBLE_EQ(mtr(5, 1), -87.50961508738959);
        EXPECT_DOUBLE_EQ(mtr(5, 2), 23.280098882479578);
        EXPECT_DOUBLE_EQ(mtr(6, 0), 8.85590979917103);
        EXPECT_DOUBLE_EQ(mtr(6, 1), -32.65290161505921);
        EXPECT_DOUBLE_EQ(mtr(6, 2), -5.0318917624474295);
        EXPECT_DOUBLE_EQ(mtr(7, 0), 32.717509759851936);
        EXPECT_DOUBLE_EQ(mtr(7, 1), 18.529868291798238);
        EXPECT_DOUBLE_EQ(mtr(7, 2), 31.50255873280196);
        EXPECT_DOUBLE_EQ(mtr(8, 0), 12.677927494307738);
        EXPECT_DOUBLE_EQ(mtr(8, 1), -46.169755352790595);
        EXPECT_DOUBLE_EQ(mtr(8, 2), 22.629046207699318);
        EXPECT_DOUBLE_EQ(mtr(9, 0), -76.92757015087707);
        EXPECT_DOUBLE_EQ(mtr(9, 1), 83.67078184672366);
        EXPECT_DOUBLE_EQ(mtr(9, 2), 3.5102931218199416);
        EXPECT_DOUBLE_EQ(mtr(10, 0), -80.99502606313347);
        EXPECT_DOUBLE_EQ(mtr(10, 1), -30.02053885691531);
        EXPECT_DOUBLE_EQ(mtr(10, 2), -95.03021938861154);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), -93.11774348806081);
        EXPECT_DOUBLE_EQ(mtc(0, 1), -14.108330840223957);
        EXPECT_DOUBLE_EQ(mtc(0, 2), 5.8022044043901815);
        EXPECT_DOUBLE_EQ(mtc(1, 0), -98.38480859022877);
        EXPECT_DOUBLE_EQ(mtc(1, 1), -94.81883611699344);
        EXPECT_DOUBLE_EQ(mtc(1, 2), -39.507965223996266);
        EXPECT_DOUBLE_EQ(mtc(2, 0), -70.06261616604155);
        EXPECT_DOUBLE_EQ(mtc(2, 1), -45.060719301725285);
        EXPECT_DOUBLE_EQ(mtc(2, 2), 38.099939917456425);
        EXPECT_DOUBLE_EQ(mtc(3, 0), 84.87535684986423);
        EXPECT_DOUBLE_EQ(mtc(3, 1), -41.383939879963094);
        EXPECT_DOUBLE_EQ(mtc(3, 2), -11.891042873050296);
        EXPECT_DOUBLE_EQ(mtc(4, 0), -99.9818642210925);
        EXPECT_DOUBLE_EQ(mtc(4, 1), 80.36741308691853);
        EXPECT_DOUBLE_EQ(mtc(4, 2), 53.89070563872062);
        EXPECT_DOUBLE_EQ(mtc(5, 0), -25.11185567441916);
        EXPECT_DOUBLE_EQ(mtc(5, 1), -87.50961508738959);
        EXPECT_DOUBLE_EQ(mtc(5, 2), 23.280098882479578);
        EXPECT_DOUBLE_EQ(mtc(6, 0), 8.85590979917103);
        EXPECT_DOUBLE_EQ(mtc(6, 1), -32.65290161505921);
        EXPECT_DOUBLE_EQ(mtc(6, 2), -5.0318917624474295);
        EXPECT_DOUBLE_EQ(mtc(7, 0), 32.717509759851936);
        EXPECT_DOUBLE_EQ(mtc(7, 1), 18.529868291798238);
        EXPECT_DOUBLE_EQ(mtc(7, 2), 31.50255873280196);
        EXPECT_DOUBLE_EQ(mtc(8, 0), 12.677927494307738);
        EXPECT_DOUBLE_EQ(mtc(8, 1), -46.169755352790595);
        EXPECT_DOUBLE_EQ(mtc(8, 2), 22.629046207699318);
        EXPECT_DOUBLE_EQ(mtc(9, 0), -76.92757015087707);
        EXPECT_DOUBLE_EQ(mtc(9, 1), 83.67078184672366);
        EXPECT_DOUBLE_EQ(mtc(9, 2), 3.5102931218199416);
        EXPECT_DOUBLE_EQ(mtc(10, 0), -80.99502606313347);
        EXPECT_DOUBLE_EQ(mtc(10, 1), -30.02053885691531);
        EXPECT_DOUBLE_EQ(mtc(10, 2), -95.03021938861154);
    }
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 19);
        m(0, 0) = 50.864090811708934;
        m(0, 1) = 86.72545584739655;
        m(0, 2) = -59.41096188367827;
        m(0, 3) = -81.01855448213378;
        m(0, 4) = -44.75527142333435;
        m(0, 5) = 6.881484559867502;
        m(0, 6) = 75.66386662485408;
        m(0, 7) = -56.002568995946575;
        m(0, 8) = -44.600865729883445;
        m(0, 9) = -18.413408652944696;
        m(0, 10) = -97.11569037525811;
        m(0, 11) = 53.19666636708692;
        m(0, 12) = -64.58909530248837;
        m(0, 13) = -13.336152508799714;
        m(0, 14) = -69.12350514623267;
        m(0, 15) = 56.52730125536351;
        m(0, 16) = 89.92552663330136;
        m(0, 17) = 94.33106257780301;
        m(0, 18) = 76.55814809986282;
        m(1, 0) = 14.747374583026797;
        m(1, 1) = -12.087041962746213;
        m(1, 2) = -63.3966872965287;
        m(1, 3) = -11.386504830855642;
        m(1, 4) = -76.29669292020178;
        m(1, 5) = -66.38097797841678;
        m(1, 6) = -20.191218640024687;
        m(1, 7) = -48.05245125934678;
        m(1, 8) = -83.87380388512868;
        m(1, 9) = -21.25569067138788;
        m(1, 10) = 4.889708648539596;
        m(1, 11) = -85.80217867074691;
        m(1, 12) = -85.26796006798745;
        m(1, 13) = 3.8169098134350605;
        m(1, 14) = 73.4920467291056;
        m(1, 15) = 98.24187210950205;
        m(1, 16) = -9.878913280704495;
        m(1, 17) = -63.027946780158196;
        m(1, 18) = 55.64310458734482;
        m(2, 0) = -75.20410363410058;
        m(2, 1) = 45.30781974344674;
        m(2, 2) = -43.85391331821933;
        m(2, 3) = 67.45134132003074;
        m(2, 4) = 55.35009554124747;
        m(2, 5) = -24.1599830304106;
        m(2, 6) = 89.85022708733555;
        m(2, 7) = 63.770995127367826;
        m(2, 8) = -7.388429976036122;
        m(2, 9) = 8.073425560498507;
        m(2, 10) = 76.76129649290999;
        m(2, 11) = -50.19697292034915;
        m(2, 12) = -25.310526646715076;
        m(2, 13) = 14.496228473119118;
        m(2, 14) = 46.35572803496012;
        m(2, 15) = -43.2905212948518;
        m(2, 16) = 72.28250601709692;
        m(2, 17) = 59.72857548888601;
        m(2, 18) = 39.776820197984875;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), 50.864090811708934);
        EXPECT_DOUBLE_EQ(mtr(0, 1), 14.747374583026797);
        EXPECT_DOUBLE_EQ(mtr(0, 2), -75.20410363410058);
        EXPECT_DOUBLE_EQ(mtr(1, 0), 86.72545584739655);
        EXPECT_DOUBLE_EQ(mtr(1, 1), -12.087041962746213);
        EXPECT_DOUBLE_EQ(mtr(1, 2), 45.30781974344674);
        EXPECT_DOUBLE_EQ(mtr(2, 0), -59.41096188367827);
        EXPECT_DOUBLE_EQ(mtr(2, 1), -63.3966872965287);
        EXPECT_DOUBLE_EQ(mtr(2, 2), -43.85391331821933);
        EXPECT_DOUBLE_EQ(mtr(3, 0), -81.01855448213378);
        EXPECT_DOUBLE_EQ(mtr(3, 1), -11.386504830855642);
        EXPECT_DOUBLE_EQ(mtr(3, 2), 67.45134132003074);
        EXPECT_DOUBLE_EQ(mtr(4, 0), -44.75527142333435);
        EXPECT_DOUBLE_EQ(mtr(4, 1), -76.29669292020178);
        EXPECT_DOUBLE_EQ(mtr(4, 2), 55.35009554124747);
        EXPECT_DOUBLE_EQ(mtr(5, 0), 6.881484559867502);
        EXPECT_DOUBLE_EQ(mtr(5, 1), -66.38097797841678);
        EXPECT_DOUBLE_EQ(mtr(5, 2), -24.1599830304106);
        EXPECT_DOUBLE_EQ(mtr(6, 0), 75.66386662485408);
        EXPECT_DOUBLE_EQ(mtr(6, 1), -20.191218640024687);
        EXPECT_DOUBLE_EQ(mtr(6, 2), 89.85022708733555);
        EXPECT_DOUBLE_EQ(mtr(7, 0), -56.002568995946575);
        EXPECT_DOUBLE_EQ(mtr(7, 1), -48.05245125934678);
        EXPECT_DOUBLE_EQ(mtr(7, 2), 63.770995127367826);
        EXPECT_DOUBLE_EQ(mtr(8, 0), -44.600865729883445);
        EXPECT_DOUBLE_EQ(mtr(8, 1), -83.87380388512868);
        EXPECT_DOUBLE_EQ(mtr(8, 2), -7.388429976036122);
        EXPECT_DOUBLE_EQ(mtr(9, 0), -18.413408652944696);
        EXPECT_DOUBLE_EQ(mtr(9, 1), -21.25569067138788);
        EXPECT_DOUBLE_EQ(mtr(9, 2), 8.073425560498507);
        EXPECT_DOUBLE_EQ(mtr(10, 0), -97.11569037525811);
        EXPECT_DOUBLE_EQ(mtr(10, 1), 4.889708648539596);
        EXPECT_DOUBLE_EQ(mtr(10, 2), 76.76129649290999);
        EXPECT_DOUBLE_EQ(mtr(11, 0), 53.19666636708692);
        EXPECT_DOUBLE_EQ(mtr(11, 1), -85.80217867074691);
        EXPECT_DOUBLE_EQ(mtr(11, 2), -50.19697292034915);
        EXPECT_DOUBLE_EQ(mtr(12, 0), -64.58909530248837);
        EXPECT_DOUBLE_EQ(mtr(12, 1), -85.26796006798745);
        EXPECT_DOUBLE_EQ(mtr(12, 2), -25.310526646715076);
        EXPECT_DOUBLE_EQ(mtr(13, 0), -13.336152508799714);
        EXPECT_DOUBLE_EQ(mtr(13, 1), 3.8169098134350605);
        EXPECT_DOUBLE_EQ(mtr(13, 2), 14.496228473119118);
        EXPECT_DOUBLE_EQ(mtr(14, 0), -69.12350514623267);
        EXPECT_DOUBLE_EQ(mtr(14, 1), 73.4920467291056);
        EXPECT_DOUBLE_EQ(mtr(14, 2), 46.35572803496012);
        EXPECT_DOUBLE_EQ(mtr(15, 0), 56.52730125536351);
        EXPECT_DOUBLE_EQ(mtr(15, 1), 98.24187210950205);
        EXPECT_DOUBLE_EQ(mtr(15, 2), -43.2905212948518);
        EXPECT_DOUBLE_EQ(mtr(16, 0), 89.92552663330136);
        EXPECT_DOUBLE_EQ(mtr(16, 1), -9.878913280704495);
        EXPECT_DOUBLE_EQ(mtr(16, 2), 72.28250601709692);
        EXPECT_DOUBLE_EQ(mtr(17, 0), 94.33106257780301);
        EXPECT_DOUBLE_EQ(mtr(17, 1), -63.027946780158196);
        EXPECT_DOUBLE_EQ(mtr(17, 2), 59.72857548888601);
        EXPECT_DOUBLE_EQ(mtr(18, 0), 76.55814809986282);
        EXPECT_DOUBLE_EQ(mtr(18, 1), 55.64310458734482);
        EXPECT_DOUBLE_EQ(mtr(18, 2), 39.776820197984875);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), 50.864090811708934);
        EXPECT_DOUBLE_EQ(mtc(0, 1), 14.747374583026797);
        EXPECT_DOUBLE_EQ(mtc(0, 2), -75.20410363410058);
        EXPECT_DOUBLE_EQ(mtc(1, 0), 86.72545584739655);
        EXPECT_DOUBLE_EQ(mtc(1, 1), -12.087041962746213);
        EXPECT_DOUBLE_EQ(mtc(1, 2), 45.30781974344674);
        EXPECT_DOUBLE_EQ(mtc(2, 0), -59.41096188367827);
        EXPECT_DOUBLE_EQ(mtc(2, 1), -63.3966872965287);
        EXPECT_DOUBLE_EQ(mtc(2, 2), -43.85391331821933);
        EXPECT_DOUBLE_EQ(mtc(3, 0), -81.01855448213378);
        EXPECT_DOUBLE_EQ(mtc(3, 1), -11.386504830855642);
        EXPECT_DOUBLE_EQ(mtc(3, 2), 67.45134132003074);
        EXPECT_DOUBLE_EQ(mtc(4, 0), -44.75527142333435);
        EXPECT_DOUBLE_EQ(mtc(4, 1), -76.29669292020178);
        EXPECT_DOUBLE_EQ(mtc(4, 2), 55.35009554124747);
        EXPECT_DOUBLE_EQ(mtc(5, 0), 6.881484559867502);
        EXPECT_DOUBLE_EQ(mtc(5, 1), -66.38097797841678);
        EXPECT_DOUBLE_EQ(mtc(5, 2), -24.1599830304106);
        EXPECT_DOUBLE_EQ(mtc(6, 0), 75.66386662485408);
        EXPECT_DOUBLE_EQ(mtc(6, 1), -20.191218640024687);
        EXPECT_DOUBLE_EQ(mtc(6, 2), 89.85022708733555);
        EXPECT_DOUBLE_EQ(mtc(7, 0), -56.002568995946575);
        EXPECT_DOUBLE_EQ(mtc(7, 1), -48.05245125934678);
        EXPECT_DOUBLE_EQ(mtc(7, 2), 63.770995127367826);
        EXPECT_DOUBLE_EQ(mtc(8, 0), -44.600865729883445);
        EXPECT_DOUBLE_EQ(mtc(8, 1), -83.87380388512868);
        EXPECT_DOUBLE_EQ(mtc(8, 2), -7.388429976036122);
        EXPECT_DOUBLE_EQ(mtc(9, 0), -18.413408652944696);
        EXPECT_DOUBLE_EQ(mtc(9, 1), -21.25569067138788);
        EXPECT_DOUBLE_EQ(mtc(9, 2), 8.073425560498507);
        EXPECT_DOUBLE_EQ(mtc(10, 0), -97.11569037525811);
        EXPECT_DOUBLE_EQ(mtc(10, 1), 4.889708648539596);
        EXPECT_DOUBLE_EQ(mtc(10, 2), 76.76129649290999);
        EXPECT_DOUBLE_EQ(mtc(11, 0), 53.19666636708692);
        EXPECT_DOUBLE_EQ(mtc(11, 1), -85.80217867074691);
        EXPECT_DOUBLE_EQ(mtc(11, 2), -50.19697292034915);
        EXPECT_DOUBLE_EQ(mtc(12, 0), -64.58909530248837);
        EXPECT_DOUBLE_EQ(mtc(12, 1), -85.26796006798745);
        EXPECT_DOUBLE_EQ(mtc(12, 2), -25.310526646715076);
        EXPECT_DOUBLE_EQ(mtc(13, 0), -13.336152508799714);
        EXPECT_DOUBLE_EQ(mtc(13, 1), 3.8169098134350605);
        EXPECT_DOUBLE_EQ(mtc(13, 2), 14.496228473119118);
        EXPECT_DOUBLE_EQ(mtc(14, 0), -69.12350514623267);
        EXPECT_DOUBLE_EQ(mtc(14, 1), 73.4920467291056);
        EXPECT_DOUBLE_EQ(mtc(14, 2), 46.35572803496012);
        EXPECT_DOUBLE_EQ(mtc(15, 0), 56.52730125536351);
        EXPECT_DOUBLE_EQ(mtc(15, 1), 98.24187210950205);
        EXPECT_DOUBLE_EQ(mtc(15, 2), -43.2905212948518);
        EXPECT_DOUBLE_EQ(mtc(16, 0), 89.92552663330136);
        EXPECT_DOUBLE_EQ(mtc(16, 1), -9.878913280704495);
        EXPECT_DOUBLE_EQ(mtc(16, 2), 72.28250601709692);
        EXPECT_DOUBLE_EQ(mtc(17, 0), 94.33106257780301);
        EXPECT_DOUBLE_EQ(mtc(17, 1), -63.027946780158196);
        EXPECT_DOUBLE_EQ(mtc(17, 2), 59.72857548888601);
        EXPECT_DOUBLE_EQ(mtc(18, 0), 76.55814809986282);
        EXPECT_DOUBLE_EQ(mtc(18, 1), 55.64310458734482);
        EXPECT_DOUBLE_EQ(mtc(18, 2), 39.776820197984875);
    }
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 12);
        m(0, 0) = -32.75375661346618;
        m(0, 1) = -13.6098421772042;
        m(0, 2) = -46.86521220477553;
        m(0, 3) = 59.00702831249865;
        m(0, 4) = -4.564740481250126;
        m(0, 5) = 16.232920948792312;
        m(0, 6) = -65.0828541930055;
        m(0, 7) = -57.88248367433246;
        m(0, 8) = -81.72734394349992;
        m(0, 9) = 28.080964462881383;
        m(0, 10) = 36.6937632974539;
        m(0, 11) = 41.35837714070166;
        m(1, 0) = -47.68004182743719;
        m(1, 1) = -64.19046526329765;
        m(1, 2) = -75.66374889412242;
        m(1, 3) = -82.35155489863575;
        m(1, 4) = -75.40948179339736;
        m(1, 5) = -21.839837867220055;
        m(1, 6) = -7.047883213897393;
        m(1, 7) = -28.576424866142986;
        m(1, 8) = 36.45450614900494;
        m(1, 9) = -9.122226758045997;
        m(1, 10) = 39.94779111587877;
        m(1, 11) = 9.684112064820866;
        m(2, 0) = 34.000255287178476;
        m(2, 1) = 64.99966038549962;
        m(2, 2) = -11.973673265362649;
        m(2, 3) = 80.2812674443403;
        m(2, 4) = 95.91223898270886;
        m(2, 5) = -27.634369350449873;
        m(2, 6) = -75.21066302899243;
        m(2, 7) = -20.700089950120855;
        m(2, 8) = 86.68513293601455;
        m(2, 9) = 75.43854998281424;
        m(2, 10) = -88.06922362937304;
        m(2, 11) = -92.34886576586136;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), -32.75375661346618);
        EXPECT_DOUBLE_EQ(mtr(0, 1), -47.68004182743719);
        EXPECT_DOUBLE_EQ(mtr(0, 2), 34.000255287178476);
        EXPECT_DOUBLE_EQ(mtr(1, 0), -13.6098421772042);
        EXPECT_DOUBLE_EQ(mtr(1, 1), -64.19046526329765);
        EXPECT_DOUBLE_EQ(mtr(1, 2), 64.99966038549962);
        EXPECT_DOUBLE_EQ(mtr(2, 0), -46.86521220477553);
        EXPECT_DOUBLE_EQ(mtr(2, 1), -75.66374889412242);
        EXPECT_DOUBLE_EQ(mtr(2, 2), -11.973673265362649);
        EXPECT_DOUBLE_EQ(mtr(3, 0), 59.00702831249865);
        EXPECT_DOUBLE_EQ(mtr(3, 1), -82.35155489863575);
        EXPECT_DOUBLE_EQ(mtr(3, 2), 80.2812674443403);
        EXPECT_DOUBLE_EQ(mtr(4, 0), -4.564740481250126);
        EXPECT_DOUBLE_EQ(mtr(4, 1), -75.40948179339736);
        EXPECT_DOUBLE_EQ(mtr(4, 2), 95.91223898270886);
        EXPECT_DOUBLE_EQ(mtr(5, 0), 16.232920948792312);
        EXPECT_DOUBLE_EQ(mtr(5, 1), -21.839837867220055);
        EXPECT_DOUBLE_EQ(mtr(5, 2), -27.634369350449873);
        EXPECT_DOUBLE_EQ(mtr(6, 0), -65.0828541930055);
        EXPECT_DOUBLE_EQ(mtr(6, 1), -7.047883213897393);
        EXPECT_DOUBLE_EQ(mtr(6, 2), -75.21066302899243);
        EXPECT_DOUBLE_EQ(mtr(7, 0), -57.88248367433246);
        EXPECT_DOUBLE_EQ(mtr(7, 1), -28.576424866142986);
        EXPECT_DOUBLE_EQ(mtr(7, 2), -20.700089950120855);
        EXPECT_DOUBLE_EQ(mtr(8, 0), -81.72734394349992);
        EXPECT_DOUBLE_EQ(mtr(8, 1), 36.45450614900494);
        EXPECT_DOUBLE_EQ(mtr(8, 2), 86.68513293601455);
        EXPECT_DOUBLE_EQ(mtr(9, 0), 28.080964462881383);
        EXPECT_DOUBLE_EQ(mtr(9, 1), -9.122226758045997);
        EXPECT_DOUBLE_EQ(mtr(9, 2), 75.43854998281424);
        EXPECT_DOUBLE_EQ(mtr(10, 0), 36.6937632974539);
        EXPECT_DOUBLE_EQ(mtr(10, 1), 39.94779111587877);
        EXPECT_DOUBLE_EQ(mtr(10, 2), -88.06922362937304);
        EXPECT_DOUBLE_EQ(mtr(11, 0), 41.35837714070166);
        EXPECT_DOUBLE_EQ(mtr(11, 1), 9.684112064820866);
        EXPECT_DOUBLE_EQ(mtr(11, 2), -92.34886576586136);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), -32.75375661346618);
        EXPECT_DOUBLE_EQ(mtc(0, 1), -47.68004182743719);
        EXPECT_DOUBLE_EQ(mtc(0, 2), 34.000255287178476);
        EXPECT_DOUBLE_EQ(mtc(1, 0), -13.6098421772042);
        EXPECT_DOUBLE_EQ(mtc(1, 1), -64.19046526329765);
        EXPECT_DOUBLE_EQ(mtc(1, 2), 64.99966038549962);
        EXPECT_DOUBLE_EQ(mtc(2, 0), -46.86521220477553);
        EXPECT_DOUBLE_EQ(mtc(2, 1), -75.66374889412242);
        EXPECT_DOUBLE_EQ(mtc(2, 2), -11.973673265362649);
        EXPECT_DOUBLE_EQ(mtc(3, 0), 59.00702831249865);
        EXPECT_DOUBLE_EQ(mtc(3, 1), -82.35155489863575);
        EXPECT_DOUBLE_EQ(mtc(3, 2), 80.2812674443403);
        EXPECT_DOUBLE_EQ(mtc(4, 0), -4.564740481250126);
        EXPECT_DOUBLE_EQ(mtc(4, 1), -75.40948179339736);
        EXPECT_DOUBLE_EQ(mtc(4, 2), 95.91223898270886);
        EXPECT_DOUBLE_EQ(mtc(5, 0), 16.232920948792312);
        EXPECT_DOUBLE_EQ(mtc(5, 1), -21.839837867220055);
        EXPECT_DOUBLE_EQ(mtc(5, 2), -27.634369350449873);
        EXPECT_DOUBLE_EQ(mtc(6, 0), -65.0828541930055);
        EXPECT_DOUBLE_EQ(mtc(6, 1), -7.047883213897393);
        EXPECT_DOUBLE_EQ(mtc(6, 2), -75.21066302899243);
        EXPECT_DOUBLE_EQ(mtc(7, 0), -57.88248367433246);
        EXPECT_DOUBLE_EQ(mtc(7, 1), -28.576424866142986);
        EXPECT_DOUBLE_EQ(mtc(7, 2), -20.700089950120855);
        EXPECT_DOUBLE_EQ(mtc(8, 0), -81.72734394349992);
        EXPECT_DOUBLE_EQ(mtc(8, 1), 36.45450614900494);
        EXPECT_DOUBLE_EQ(mtc(8, 2), 86.68513293601455);
        EXPECT_DOUBLE_EQ(mtc(9, 0), 28.080964462881383);
        EXPECT_DOUBLE_EQ(mtc(9, 1), -9.122226758045997);
        EXPECT_DOUBLE_EQ(mtc(9, 2), 75.43854998281424);
        EXPECT_DOUBLE_EQ(mtc(10, 0), 36.6937632974539);
        EXPECT_DOUBLE_EQ(mtc(10, 1), 39.94779111587877);
        EXPECT_DOUBLE_EQ(mtc(10, 2), -88.06922362937304);
        EXPECT_DOUBLE_EQ(mtc(11, 0), 41.35837714070166);
        EXPECT_DOUBLE_EQ(mtc(11, 1), 9.684112064820866);
        EXPECT_DOUBLE_EQ(mtc(11, 2), -92.34886576586136);
    }
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 17);
        m(0, 0) = 41.19222807334356;
        m(0, 1) = -9.647827035990119;
        m(0, 2) = 79.08578232010518;
        m(0, 3) = -81.30050511004372;
        m(0, 4) = 5.2008331502779725;
        m(0, 5) = -94.16930980955891;
        m(0, 6) = -13.738166181380976;
        m(0, 7) = 31.708028058804274;
        m(0, 8) = -98.07812519655093;
        m(0, 9) = -51.718134217817926;
        m(0, 10) = -81.49405897174573;
        m(0, 11) = 86.09136014594006;
        m(0, 12) = -23.14506976740256;
        m(0, 13) = 76.3616884219812;
        m(0, 14) = 60.28344358729666;
        m(0, 15) = -35.34123633864937;
        m(0, 16) = -87.33936780992902;
        m(1, 0) = 25.563530352835954;
        m(1, 1) = -43.62388501728416;
        m(1, 2) = 0.5379451108277209;
        m(1, 3) = 40.11963964000961;
        m(1, 4) = -63.945471933511236;
        m(1, 5) = 25.47334071885645;
        m(1, 6) = 20.998951793092573;
        m(1, 7) = 23.964236092014318;
        m(1, 8) = -53.69611952912465;
        m(1, 9) = -48.45849352784126;
        m(1, 10) = 0.03386109792266723;
        m(1, 11) = -43.90344163766924;
        m(1, 12) = -6.698621092523396;
        m(1, 13) = -99.37831178796779;
        m(1, 14) = -9.64088536276411;
        m(1, 15) = 3.118955974716698;
        m(1, 16) = -81.5481380106742;
        m(2, 0) = 62.07279507925867;
        m(2, 1) = 90.29145840318458;
        m(2, 2) = -25.71415288702252;
        m(2, 3) = 74.7395459171091;
        m(2, 4) = 24.394997421168824;
        m(2, 5) = -58.2301634354434;
        m(2, 6) = -4.768291835922895;
        m(2, 7) = 49.704487303266575;
        m(2, 8) = 18.65157355854312;
        m(2, 9) = 98.9073219636636;
        m(2, 10) = -45.19000115648366;
        m(2, 11) = -45.249286237965315;
        m(2, 12) = 97.09143831741096;
        m(2, 13) = -31.80834068260583;
        m(2, 14) = -78.03982967131924;
        m(2, 15) = -14.844621355572116;
        m(2, 16) = -66.64707457523824;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), 41.19222807334356);
        EXPECT_DOUBLE_EQ(mtr(0, 1), 25.563530352835954);
        EXPECT_DOUBLE_EQ(mtr(0, 2), 62.07279507925867);
        EXPECT_DOUBLE_EQ(mtr(1, 0), -9.647827035990119);
        EXPECT_DOUBLE_EQ(mtr(1, 1), -43.62388501728416);
        EXPECT_DOUBLE_EQ(mtr(1, 2), 90.29145840318458);
        EXPECT_DOUBLE_EQ(mtr(2, 0), 79.08578232010518);
        EXPECT_DOUBLE_EQ(mtr(2, 1), 0.5379451108277209);
        EXPECT_DOUBLE_EQ(mtr(2, 2), -25.71415288702252);
        EXPECT_DOUBLE_EQ(mtr(3, 0), -81.30050511004372);
        EXPECT_DOUBLE_EQ(mtr(3, 1), 40.11963964000961);
        EXPECT_DOUBLE_EQ(mtr(3, 2), 74.7395459171091);
        EXPECT_DOUBLE_EQ(mtr(4, 0), 5.2008331502779725);
        EXPECT_DOUBLE_EQ(mtr(4, 1), -63.945471933511236);
        EXPECT_DOUBLE_EQ(mtr(4, 2), 24.394997421168824);
        EXPECT_DOUBLE_EQ(mtr(5, 0), -94.16930980955891);
        EXPECT_DOUBLE_EQ(mtr(5, 1), 25.47334071885645);
        EXPECT_DOUBLE_EQ(mtr(5, 2), -58.2301634354434);
        EXPECT_DOUBLE_EQ(mtr(6, 0), -13.738166181380976);
        EXPECT_DOUBLE_EQ(mtr(6, 1), 20.998951793092573);
        EXPECT_DOUBLE_EQ(mtr(6, 2), -4.768291835922895);
        EXPECT_DOUBLE_EQ(mtr(7, 0), 31.708028058804274);
        EXPECT_DOUBLE_EQ(mtr(7, 1), 23.964236092014318);
        EXPECT_DOUBLE_EQ(mtr(7, 2), 49.704487303266575);
        EXPECT_DOUBLE_EQ(mtr(8, 0), -98.07812519655093);
        EXPECT_DOUBLE_EQ(mtr(8, 1), -53.69611952912465);
        EXPECT_DOUBLE_EQ(mtr(8, 2), 18.65157355854312);
        EXPECT_DOUBLE_EQ(mtr(9, 0), -51.718134217817926);
        EXPECT_DOUBLE_EQ(mtr(9, 1), -48.45849352784126);
        EXPECT_DOUBLE_EQ(mtr(9, 2), 98.9073219636636);
        EXPECT_DOUBLE_EQ(mtr(10, 0), -81.49405897174573);
        EXPECT_DOUBLE_EQ(mtr(10, 1), 0.03386109792266723);
        EXPECT_DOUBLE_EQ(mtr(10, 2), -45.19000115648366);
        EXPECT_DOUBLE_EQ(mtr(11, 0), 86.09136014594006);
        EXPECT_DOUBLE_EQ(mtr(11, 1), -43.90344163766924);
        EXPECT_DOUBLE_EQ(mtr(11, 2), -45.249286237965315);
        EXPECT_DOUBLE_EQ(mtr(12, 0), -23.14506976740256);
        EXPECT_DOUBLE_EQ(mtr(12, 1), -6.698621092523396);
        EXPECT_DOUBLE_EQ(mtr(12, 2), 97.09143831741096);
        EXPECT_DOUBLE_EQ(mtr(13, 0), 76.3616884219812);
        EXPECT_DOUBLE_EQ(mtr(13, 1), -99.37831178796779);
        EXPECT_DOUBLE_EQ(mtr(13, 2), -31.80834068260583);
        EXPECT_DOUBLE_EQ(mtr(14, 0), 60.28344358729666);
        EXPECT_DOUBLE_EQ(mtr(14, 1), -9.64088536276411);
        EXPECT_DOUBLE_EQ(mtr(14, 2), -78.03982967131924);
        EXPECT_DOUBLE_EQ(mtr(15, 0), -35.34123633864937);
        EXPECT_DOUBLE_EQ(mtr(15, 1), 3.118955974716698);
        EXPECT_DOUBLE_EQ(mtr(15, 2), -14.844621355572116);
        EXPECT_DOUBLE_EQ(mtr(16, 0), -87.33936780992902);
        EXPECT_DOUBLE_EQ(mtr(16, 1), -81.5481380106742);
        EXPECT_DOUBLE_EQ(mtr(16, 2), -66.64707457523824);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), 41.19222807334356);
        EXPECT_DOUBLE_EQ(mtc(0, 1), 25.563530352835954);
        EXPECT_DOUBLE_EQ(mtc(0, 2), 62.07279507925867);
        EXPECT_DOUBLE_EQ(mtc(1, 0), -9.647827035990119);
        EXPECT_DOUBLE_EQ(mtc(1, 1), -43.62388501728416);
        EXPECT_DOUBLE_EQ(mtc(1, 2), 90.29145840318458);
        EXPECT_DOUBLE_EQ(mtc(2, 0), 79.08578232010518);
        EXPECT_DOUBLE_EQ(mtc(2, 1), 0.5379451108277209);
        EXPECT_DOUBLE_EQ(mtc(2, 2), -25.71415288702252);
        EXPECT_DOUBLE_EQ(mtc(3, 0), -81.30050511004372);
        EXPECT_DOUBLE_EQ(mtc(3, 1), 40.11963964000961);
        EXPECT_DOUBLE_EQ(mtc(3, 2), 74.7395459171091);
        EXPECT_DOUBLE_EQ(mtc(4, 0), 5.2008331502779725);
        EXPECT_DOUBLE_EQ(mtc(4, 1), -63.945471933511236);
        EXPECT_DOUBLE_EQ(mtc(4, 2), 24.394997421168824);
        EXPECT_DOUBLE_EQ(mtc(5, 0), -94.16930980955891);
        EXPECT_DOUBLE_EQ(mtc(5, 1), 25.47334071885645);
        EXPECT_DOUBLE_EQ(mtc(5, 2), -58.2301634354434);
        EXPECT_DOUBLE_EQ(mtc(6, 0), -13.738166181380976);
        EXPECT_DOUBLE_EQ(mtc(6, 1), 20.998951793092573);
        EXPECT_DOUBLE_EQ(mtc(6, 2), -4.768291835922895);
        EXPECT_DOUBLE_EQ(mtc(7, 0), 31.708028058804274);
        EXPECT_DOUBLE_EQ(mtc(7, 1), 23.964236092014318);
        EXPECT_DOUBLE_EQ(mtc(7, 2), 49.704487303266575);
        EXPECT_DOUBLE_EQ(mtc(8, 0), -98.07812519655093);
        EXPECT_DOUBLE_EQ(mtc(8, 1), -53.69611952912465);
        EXPECT_DOUBLE_EQ(mtc(8, 2), 18.65157355854312);
        EXPECT_DOUBLE_EQ(mtc(9, 0), -51.718134217817926);
        EXPECT_DOUBLE_EQ(mtc(9, 1), -48.45849352784126);
        EXPECT_DOUBLE_EQ(mtc(9, 2), 98.9073219636636);
        EXPECT_DOUBLE_EQ(mtc(10, 0), -81.49405897174573);
        EXPECT_DOUBLE_EQ(mtc(10, 1), 0.03386109792266723);
        EXPECT_DOUBLE_EQ(mtc(10, 2), -45.19000115648366);
        EXPECT_DOUBLE_EQ(mtc(11, 0), 86.09136014594006);
        EXPECT_DOUBLE_EQ(mtc(11, 1), -43.90344163766924);
        EXPECT_DOUBLE_EQ(mtc(11, 2), -45.249286237965315);
        EXPECT_DOUBLE_EQ(mtc(12, 0), -23.14506976740256);
        EXPECT_DOUBLE_EQ(mtc(12, 1), -6.698621092523396);
        EXPECT_DOUBLE_EQ(mtc(12, 2), 97.09143831741096);
        EXPECT_DOUBLE_EQ(mtc(13, 0), 76.3616884219812);
        EXPECT_DOUBLE_EQ(mtc(13, 1), -99.37831178796779);
        EXPECT_DOUBLE_EQ(mtc(13, 2), -31.80834068260583);
        EXPECT_DOUBLE_EQ(mtc(14, 0), 60.28344358729666);
        EXPECT_DOUBLE_EQ(mtc(14, 1), -9.64088536276411);
        EXPECT_DOUBLE_EQ(mtc(14, 2), -78.03982967131924);
        EXPECT_DOUBLE_EQ(mtc(15, 0), -35.34123633864937);
        EXPECT_DOUBLE_EQ(mtc(15, 1), 3.118955974716698);
        EXPECT_DOUBLE_EQ(mtc(15, 2), -14.844621355572116);
        EXPECT_DOUBLE_EQ(mtc(16, 0), -87.33936780992902);
        EXPECT_DOUBLE_EQ(mtc(16, 1), -81.5481380106742);
        EXPECT_DOUBLE_EQ(mtc(16, 2), -66.64707457523824);
    }
    {
        Matrix<double, 3, -1, ColumnStorage> m;
        m.resize(3, 11);
        m(0, 0) = -44.385915446696366;
        m(0, 1) = 28.793505461441015;
        m(0, 2) = 71.2114986465838;
        m(0, 3) = 51.14773880111491;
        m(0, 4) = -7.958682467368476;
        m(0, 5) = -83.09905041318346;
        m(0, 6) = -22.191719125506793;
        m(0, 7) = -2.2844026553076873;
        m(0, 8) = -85.89049887253955;
        m(0, 9) = 7.359151344016439;
        m(0, 10) = -12.836173824817394;
        m(1, 0) = 60.864624834962456;
        m(1, 1) = 55.31797716120735;
        m(1, 2) = 54.86505134841502;
        m(1, 3) = 1.2088001265842365;
        m(1, 4) = 51.71783583087824;
        m(1, 5) = -97.7984372019131;
        m(1, 6) = -21.276052450577225;
        m(1, 7) = -38.9853136735308;
        m(1, 8) = -83.47696130822689;
        m(1, 9) = 3.197398523431062;
        m(1, 10) = -81.03476411018644;
        m(2, 0) = 78.17495315633076;
        m(2, 1) = -81.81693970564498;
        m(2, 2) = -30.34183030075195;
        m(2, 3) = -15.609525205781651;
        m(2, 4) = -27.0093291175411;
        m(2, 5) = 42.95413233280735;
        m(2, 6) = -72.61359152573652;
        m(2, 7) = 78.95917814822454;
        m(2, 8) = -83.12124753315223;
        m(2, 9) = 74.1286028999458;
        m(2, 10) = -87.09605709830836;
        Matrix<double, -1, 3, RowStorage> mtr = m.transpose<double, -1, 3, RowStorage>();
        EXPECT_DOUBLE_EQ(mtr(0, 0), -44.385915446696366);
        EXPECT_DOUBLE_EQ(mtr(0, 1), 60.864624834962456);
        EXPECT_DOUBLE_EQ(mtr(0, 2), 78.17495315633076);
        EXPECT_DOUBLE_EQ(mtr(1, 0), 28.793505461441015);
        EXPECT_DOUBLE_EQ(mtr(1, 1), 55.31797716120735);
        EXPECT_DOUBLE_EQ(mtr(1, 2), -81.81693970564498);
        EXPECT_DOUBLE_EQ(mtr(2, 0), 71.2114986465838);
        EXPECT_DOUBLE_EQ(mtr(2, 1), 54.86505134841502);
        EXPECT_DOUBLE_EQ(mtr(2, 2), -30.34183030075195);
        EXPECT_DOUBLE_EQ(mtr(3, 0), 51.14773880111491);
        EXPECT_DOUBLE_EQ(mtr(3, 1), 1.2088001265842365);
        EXPECT_DOUBLE_EQ(mtr(3, 2), -15.609525205781651);
        EXPECT_DOUBLE_EQ(mtr(4, 0), -7.958682467368476);
        EXPECT_DOUBLE_EQ(mtr(4, 1), 51.71783583087824);
        EXPECT_DOUBLE_EQ(mtr(4, 2), -27.0093291175411);
        EXPECT_DOUBLE_EQ(mtr(5, 0), -83.09905041318346);
        EXPECT_DOUBLE_EQ(mtr(5, 1), -97.7984372019131);
        EXPECT_DOUBLE_EQ(mtr(5, 2), 42.95413233280735);
        EXPECT_DOUBLE_EQ(mtr(6, 0), -22.191719125506793);
        EXPECT_DOUBLE_EQ(mtr(6, 1), -21.276052450577225);
        EXPECT_DOUBLE_EQ(mtr(6, 2), -72.61359152573652);
        EXPECT_DOUBLE_EQ(mtr(7, 0), -2.2844026553076873);
        EXPECT_DOUBLE_EQ(mtr(7, 1), -38.9853136735308);
        EXPECT_DOUBLE_EQ(mtr(7, 2), 78.95917814822454);
        EXPECT_DOUBLE_EQ(mtr(8, 0), -85.89049887253955);
        EXPECT_DOUBLE_EQ(mtr(8, 1), -83.47696130822689);
        EXPECT_DOUBLE_EQ(mtr(8, 2), -83.12124753315223);
        EXPECT_DOUBLE_EQ(mtr(9, 0), 7.359151344016439);
        EXPECT_DOUBLE_EQ(mtr(9, 1), 3.197398523431062);
        EXPECT_DOUBLE_EQ(mtr(9, 2), 74.1286028999458);
        EXPECT_DOUBLE_EQ(mtr(10, 0), -12.836173824817394);
        EXPECT_DOUBLE_EQ(mtr(10, 1), -81.03476411018644);
        EXPECT_DOUBLE_EQ(mtr(10, 2), -87.09605709830836);
        Matrix<double, -1, 3, ColumnStorage> mtc = m.transpose<double, -1, 3, ColumnStorage>();
        EXPECT_DOUBLE_EQ(mtc(0, 0), -44.385915446696366);
        EXPECT_DOUBLE_EQ(mtc(0, 1), 60.864624834962456);
        EXPECT_DOUBLE_EQ(mtc(0, 2), 78.17495315633076);
        EXPECT_DOUBLE_EQ(mtc(1, 0), 28.793505461441015);
        EXPECT_DOUBLE_EQ(mtc(1, 1), 55.31797716120735);
        EXPECT_DOUBLE_EQ(mtc(1, 2), -81.81693970564498);
        EXPECT_DOUBLE_EQ(mtc(2, 0), 71.2114986465838);
        EXPECT_DOUBLE_EQ(mtc(2, 1), 54.86505134841502);
        EXPECT_DOUBLE_EQ(mtc(2, 2), -30.34183030075195);
        EXPECT_DOUBLE_EQ(mtc(3, 0), 51.14773880111491);
        EXPECT_DOUBLE_EQ(mtc(3, 1), 1.2088001265842365);
        EXPECT_DOUBLE_EQ(mtc(3, 2), -15.609525205781651);
        EXPECT_DOUBLE_EQ(mtc(4, 0), -7.958682467368476);
        EXPECT_DOUBLE_EQ(mtc(4, 1), 51.71783583087824);
        EXPECT_DOUBLE_EQ(mtc(4, 2), -27.0093291175411);
        EXPECT_DOUBLE_EQ(mtc(5, 0), -83.09905041318346);
        EXPECT_DOUBLE_EQ(mtc(5, 1), -97.7984372019131);
        EXPECT_DOUBLE_EQ(mtc(5, 2), 42.95413233280735);
        EXPECT_DOUBLE_EQ(mtc(6, 0), -22.191719125506793);
        EXPECT_DOUBLE_EQ(mtc(6, 1), -21.276052450577225);
        EXPECT_DOUBLE_EQ(mtc(6, 2), -72.61359152573652);
        EXPECT_DOUBLE_EQ(mtc(7, 0), -2.2844026553076873);
        EXPECT_DOUBLE_EQ(mtc(7, 1), -38.9853136735308);
        EXPECT_DOUBLE_EQ(mtc(7, 2), 78.95917814822454);
        EXPECT_DOUBLE_EQ(mtc(8, 0), -85.89049887253955);
        EXPECT_DOUBLE_EQ(mtc(8, 1), -83.47696130822689);
        EXPECT_DOUBLE_EQ(mtc(8, 2), -83.12124753315223);
        EXPECT_DOUBLE_EQ(mtc(9, 0), 7.359151344016439);
        EXPECT_DOUBLE_EQ(mtc(9, 1), 3.197398523431062);
        EXPECT_DOUBLE_EQ(mtc(9, 2), 74.1286028999458);
        EXPECT_DOUBLE_EQ(mtc(10, 0), -12.836173824817394);
        EXPECT_DOUBLE_EQ(mtc(10, 1), -81.03476411018644);
        EXPECT_DOUBLE_EQ(mtc(10, 2), -87.09605709830836);
    }
}
